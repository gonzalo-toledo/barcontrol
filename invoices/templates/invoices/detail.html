{% extends "base.html" %}
{% block title %}Factura {{ inv.numero }}{% endblock %}

{% block content %}
  <div class="card pad">
    <div style="display:flex;justify-content:space-between;gap:1rem;align-items:flex-start">
      <div>
        <h1 style="margin:0">Factura {{ inv.numero }}</h1>
        <p class="muted">Creada el {{ inv.creado_en }}</p>
      </div>
      <div style="display:flex;gap:.5rem">
        <a class="btn" href="{% url 'list_invoices' %}">Volver</a>
        <a class="btn btn-primary" href="{% url 'invoice_view_original' inv.pk %}">Ver original</a>
      </div>
    </div>

    <div class="section grid" style="grid-template-columns:repeat(auto-fit,minmax(260px,1fr))">
      <div class="card pad">
        <h3 style="margin:0 0 .5rem">Proveedor</h3>
        <div><strong>{{ inv.proveedor.nombre }}</strong></div>
        <div class="muted">ID fiscal: {{ inv.proveedor.id_fiscal|default:"-" }}</div>
        <div class="muted">Dirección: {{ inv.proveedor.direccion|default:"-" }}</div>
      </div>

      <div class="card pad">
        <h3 style="margin:0 0 .5rem">Cliente</h3>
        <div><strong>{{ inv.cliente_nombre|default:"-" }}</strong></div>
        <div class="muted">ID fiscal: {{ inv.cliente_id_fiscal|default:"-" }}</div>
        <div class="muted">Dirección: {{ inv.cliente_direccion|default:"-" }}</div>
      </div>

      <div class="card pad">
        <h3 style="margin:0 0 .5rem">Factura</h3>
        <div>Fecha: <strong>{{ inv.fecha|default:"-" }}</strong></div>
        <div>Moneda: <strong>{{ inv.moneda|default:"ARS" }}</strong></div>
        <div>Condición de pago: <strong>{{ inv.condicion_pago|default:"-" }}</strong></div>
        <div>Vencimiento: <strong>{{ inv.vencimiento|default:"-" }}</strong></div>
        <div>Servicio: 
          {% if inv.servicio_desde and inv.servicio_hasta %}
            <strong>{{ inv.servicio_desde }} → {{ inv.servicio_hasta }}</strong>
          {% else %}
            <span class="muted">-</span>
          {% endif %}
        </div>
      </div>

      <div class="card pad">
        <h3 style="margin:0 0 .5rem">Resumen</h3>
        <div>Subtotal: <strong class="mono">{{ inv.subtotal|default:"-" }} {{ inv.moneda|default:"ARS" }}</strong></div>
        <div>Impuestos: <strong class="mono">{{ inv.total_impuestos|default:"-" }} {{ inv.moneda|default:"ARS" }}</strong></div>
        <div>Total: <strong class="mono">{{ inv.total|default:"-" }} {{ inv.moneda|default:"ARS" }}</strong></div>
      </div>
    </div>

    <div class="section">
      <h3 style="margin:.25rem 0 1rem">Ítems</h3>
      {% if inv.items.all %}
        <div style="overflow:auto">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Descripción</th>
                <th class="center">Cant.</th>
                <th class="center">Unidad</th>
                <th class="right">Precio unit.</th>
                <th class="right">Importe</th>
                <th>Código</th>
                <th>Fecha</th>
              </tr>
            </thead>
            <tbody>
              {% for it in inv.items.all %}
                <tr>
                  <td class="center">{{ forloop.counter }}</td>
                  <td><strong>{{ it.descripcion }}</strong></td>
                  <td class="center">{{ it.cantidad|default:"-" }}</td>
                  <td class="center">{{ it.unidad|default:"-" }}</td>
                  <td class="right mono">{{ it.precio_unitario|default:"-" }}</td>
                  <td class="right mono">{{ it.importe|default:"-" }}</td>
                  <td class="mono">{{ it.codigo_producto|default:"-" }}</td>
                  <td>{{ it.fecha_item|default:"-" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="muted">La factura no tiene ítems.</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
